"use strict";$(function(){var e,s,r,n,a="/user-service/api/v1";function d(e){var s=e.url,n=e.data,t=e.type,o=window.sessionStorage.getItem("hwUserToken");return $.ajax({url:s,type:t,data:JSON.stringify(n),contentType:"application/json;charset=utf-8",beforeSend:function(e){o&&e.setRequestHeader("Authorization",o)},dataType:"json"})}function t(e,s){var n=$.trim($(e).val()),t=$(s).val();return n||$(e).siblings(".errmsg").html("用户名不能为空"),t||$(s).siblings(".errmsg").html("密码不能为空"),!(!n||!t)&&{username:n,psd:t}}function o(e,s){var n=$(e).val(),t=$(s).val(),o=/^1[34578]\d{9}$/.test(n),r=/^\d{4}$/.test(t);return o||$(e).siblings(".errmsg").html("手机号码格式不正确"),r||$(s).siblings(".errmsg").html("验证码格式不正确"),!(!o||!r)&&{phone:n,code:t}}function l(){$(".errmsg").html("")}function u(e){window.sessionStorage.setItem("hwUserToken",e)}function c(e){window.sessionStorage.setItem("hwUserId",e.id),window.sessionStorage.setItem("hwuserRole",JSON.stringify(e.role))}function i(){l();var e,s,n,t,o,r=(e=$("#regUserName").val(),s=$("#regPsd").val(),n=/^[a-zA-Z0-9_-]{4,16}$/.test($.trim(e)),t=/^.*(?=.{6,})(?=.*\d)(?=.*[A-Z])(?=.*[a-z]).*$/.test(s),o=s===$("#confirmPsd").val(),n||$("#regnameErr").html("用户名需要由4-16位大小写字母，数字，下划线组合"),t||$("#regpsdErr").html("请输入大于6位，且至少包含有一个大写字母，一个小写字母和一个数字"),o||$("#regconfirmpsdErr").html("两次密码不一致"),!!(n&&t&&o)&&{username:e,psd:s}),i=$("[name='userrole']").filter(":checked").val();r&&d({url:a+"/users/register/",data:{username:r.username,password:r.psd,role:parseInt(i)},type:"POST"}).done(function(e){$("#regErr").html(e.message),console.log(e),0===e.code&&(u(e.data.token),c(e.data),$(".bindPhone").addClass("on").siblings("div").removeClass("on"))})}function m(e,s,n){l();var t=$(e).val();/^1[34578]\d{9}$/.test(t)?d({url:a+"/users/sms/",data:{phone_number:t,type:s},type:"POST"}).done(function(e){!function(e){$(e).attr("disabled","true");var s=60,n=setInterval(function(){1==s--&&($(e).removeAttr("disabled"),clearInterval(n)),$(e).html(0==s?"获取验证码":s+"s")},1e3)}(n),n.data("serialNumber",e.data.serial_number)}):$(e).siblings(".errmsg").html("手机号码格式不正确")}function g(e,s){$(e).on("click",function(){$(s).addClass("on").siblings("div").removeClass("on")})}"reg"===(s=(e=null==e?window.location.href:e).substring(e.lastIndexOf("?")+1),r={},s.replace(/([^?&=]+)=([^?&=]*)/g,function(e,s,n){var t=decodeURIComponent(s),o=decodeURIComponent(n);return o=String(o),r[t]=o,e}),r).target&&$(".chooseRole").addClass("on").siblings("div").removeClass("on"),g("#toRegister",".chooseRole"),g("#tologin",".loginForm"),g(".chooseRole label",".userRegister"),g("#forgetpsd a",".resetpsd"),$("#loginbtn").on("click",function(){!function(){l();var e=t("#loginUserName","#loginPsd");e&&d({url:a+"/users/login/",data:{username:e.username,password:e.psd,type:2},type:"POST"}).done(function(e){console.log(e),$("#loginErr").html(e.message),0===e.code&&(u(e.data.token),c(e.data))}).fail(function(e){console.log(e)})}()}),$("#nextstep").on("click",function(){i()}),$("#sendBindMsg").on("click",function(){m("#bindphoneNum",6,$(this))}),$("#sendResetPsdMsg").on("click",function(){m("#resetPsdPhone",4,$(this))}),$("#complete").on("click",function(){!function(){l();var e=$("#sendBindMsg").data("serialNumber"),s=o("#bindphoneNum","#verifyCode");s&&d({url:a+"/users/phone/binding/",data:{phone_number:s.phone,verify_code:s.code,serial_number:e,type:6},type:"POST"}).done(function(e){console.log(e),$("#bindmsg").html(e.message)})}()}),$("#resetPsd").on("click",function(){!function(){l();var e=$("#sendResetPsdMsg").data("serialNumber"),s=o("#resetPsdPhone","#resetPsdverifyCode"),n=t("#resetPsdName","#resetPsdCode");s&&n&&d({url:a+"/users/password/",data:{username:n.username,password:n.psd,verify_code:s.code,serial_number:e,sms_type:4},type:"put"}).done(function(e){console.log(1,e)})}()}),n=".imgbox",$(n).mouseenter(function(){var r=$(this).offset().left,i=$(this).offset().top,a=$(this).outerWidth(),d=$(this).outerHeight();$(this).mousemove(function(e){var t,o,s=e.pageX-r,n=e.pageY-i;t=s-a/2,o=d/2-n,$(this).find("img").each(function(e,s){var n=10+10*e;$(s).css({transform:"translateY("+t/n+"px) translateX("+o/n+"px) "})})})}),$(n).mouseleave(function(){$(this).css({transform:"rotateY(0deg) rotateX(0deg)"})})});
//# sourceMappingURL=login.js.map
