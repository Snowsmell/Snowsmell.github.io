"use strict";$(function(){var e,s,o,r="api未定";function i(e){var s=e.url,n=e.data,t=e.type,r=CookieUtil.get("hwUserToken");return $.ajax({url:s,type:t,data:JSON.stringify(n),contentType:"application/json;charset=utf-8",beforeSend:function(e){r&&e.setRequestHeader("Authorization",r)},dataType:"json"})}console.log(r),"reg"===(s=(e=null==e?window.location.href:e).substring(e.lastIndexOf("?")+1),o={},s.replace(/([^?&=]+)=([^?&=]*)/g,function(e,s,n){var t=decodeURIComponent(s),r=decodeURIComponent(n);return r=String(r),o[t]=r,e}),o).target&&$(".chooseRole").addClass("on").siblings("div").removeClass("on");var n,t=function(e,s){var n=$.trim($(e).val()),t=$(s).val();return n||$(e).siblings(".errmsg").html("用户名不能为空"),t||$(s).siblings(".errmsg").html("密码不能为空"),!(!n||!t)&&{username:n,psd:t}},a=function(){var e=$("#regUserName").val(),s=$("#regPsd").val(),n=/^[a-zA-Z0-9_-]{4,16}$/.test($.trim(e)),t=/^.*(?=.{6,})(?=.*\d)(?=.*[a-z]).*$/.test(s),r=s===$("#confirmPsd").val();return n||$("#regnameErr").html("由4-16位大小写字母，数字，下划线组合"),t||$("#regpsdErr").html("请输入大于6位，且同时包含字母和数字"),r||$("#regconfirmpsdErr").html("两次密码不一致"),!!(n&&t&&r)&&{username:e,psd:s}},d=function(e,s){var n=$(e).val(),t=$(s).val(),r=/^1[34578]\d{9}$/.test(n),o=/^\d{4}$/.test(t);return r||$(e).siblings(".errmsg").html("手机号码格式不正确"),o||$(s).siblings(".errmsg").html("验证码格式不正确"),!(!r||!o)&&{phone:n,code:t}};function l(){$(".errmsg").html("")}function u(e){var s=new Date;s.setTime(s.getTime()+6e4),CookieUtil.set("hwUserToken",e,s)}function m(e){CookieUtil.set("hwUserData",JSON.stringify(e))}function c(e,s,n){l();var t=$(e).val();/^1[34578]\d{9}$/.test(t)?i({url:r+"/users/sms/",data:{phone_number:t,type:s},type:"POST"}).done(function(e){!function(e){$(e).attr("disabled","true");var s=60,n=setInterval(function(){1==s--&&($(e).removeAttr("disabled"),clearInterval(n)),$(e).html(0==s?"获取验证码":s+"s")},1e3)}(n),n.data("serialNumber",e.data.serial_number)}):$(e).siblings(".errmsg").html("手机号码格式不正确")}function p(e,s){$(e).on("click",function(){$(s).addClass("on").siblings("div").removeClass("on")})}p("#toRegister",".chooseRole"),p("#tologin",".loginForm"),p(".chooseRole label",".userRegister"),p("#forgetpsd a",".resetpsd"),$("#loginbtn").on("click",function(){!function(){l();var e=t("#loginUserName","#loginPsd");e&&i({url:r+"/users/login/",data:{username:e.username,password:e.psd,type:2},type:"POST"}).done(function(e){console.log(e),$("#loginErr").html(e.message),0===e.code&&(u(e.data.token),m(e.data))}).fail(function(e){console.log(e)})}()}),$("#nextstep").on("click",function(){!function(){l();var e=a(),s=$("[name='userrole']").filter(":checked").val();e&&i({url:r+"/users/register/",data:{username:e.username,password:e.psd,role:parseInt(s)},type:"POST"}).done(function(e){$("#regErr").html(e.message),console.log(e),0===e.code&&(u(e.data.token),m(e.data),$(".bindPhone").addClass("on").siblings("div").removeClass("on"))})}()}),$("#complete").on("click",function(){!function(){l();var e=$("#sendBindMsg").data("serialNumber"),s=d("#bindphoneNum","#verifyCode");s&&i({url:r+"/users/phone/binding/",data:{phone_number:s.phone,verify_code:s.code,serial_number:e,type:6},type:"POST"}).done(function(e){console.log(e),$("#bindmsg").html(e.message)})}()}),$("#resetPsd").on("click",function(){!function(){l();var e=$("#sendResetPsdMsg").data("serialNumber"),s=d("#resetPsdPhone","#resetPsdverifyCode"),n=t("#resetPsdName","#resetPsdCode");s&&n&&i({url:r+"/users/password/",data:{username:n.username,password:n.psd,verify_code:s.code,serial_number:e,sms_type:4},type:"put"}).done(function(e){console.log(1,e)})}()}),$("#sendBindMsg").on("click",function(){c("#bindphoneNum",6,$(this))}),$("#sendResetPsdMsg").on("click",function(){c("#resetPsdPhone",4,$(this))}),$(".loginForm>div").on("click","span",function(){$(this).addClass("on").siblings().removeClass("on")}),$(".form-item").on("keyup","input",function(){l();var e=$(this).parents(".form-item");switch(e.data("type")){case"loginForm":t("#loginUserName","#loginPsd")?e.find("input:submit").addClass("prepared"):e.find("input:submit").removeClass("prepared");break;case"userRegister":a()?e.find("input:submit").addClass("prepared"):e.find("input:submit").removeClass("prepared");break;case"bindPhone":d("#bindphoneNum","#verifyCode")?e.find("input:submit").addClass("prepared"):e.find("input:submit").removeClass("prepared");break;case"resetpsd":return void(d("#resetPsdPhone","#resetPsdverifyCode")&&t("#resetPsdName","#resetPsdCode")?e.find("input:submit").addClass("prepared"):e.find("input:submit").removeClass("prepared"))}}),n=".imgbox",$(n).mouseenter(function(){var o=$(this).offset().left,i=$(this).offset().top,a=$(this).outerWidth(),d=$(this).outerHeight();$(this).mousemove(function(e){var t,r,s=e.pageX-o,n=e.pageY-i;t=s-a/2,r=d/2-n,$(this).find("img").each(function(e,s){var n=10+10*e;$(s).css({transform:"translateY("+t/n+"px) translateX("+r/n+"px) "})})})}),$(n).mouseleave(function(){$(this).css({transform:"rotateY(0deg) rotateX(0deg)"})})});
//# sourceMappingURL=login.js.map
